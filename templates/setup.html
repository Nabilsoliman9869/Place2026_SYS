<!doctype html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>إعدادات المطور - Place 2026</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="bg-dark d-flex align-items-center justify-content-center" style="min-height: 100vh;">

    <div class="card shadow p-4" style="width: 550px;">
        <h3 class="text-center mb-4 text-warning">
            <i class="fas fa-code"></i> منطقة المطورين
        </h3>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% if not authorized %}
        <!-- Login Form -->
        <p class="text-center text-muted">هذه المنطقة مخصصة للمطورين فقط. يرجى تسجيل الدخول.</p>
        <form action="{{ url_for('setup_login') }}" method="post">
            <div class="mb-3">
                <label class="form-label fw-bold">اسم المستخدم</label>
                <input type="text" name="username" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label fw-bold">كلمة المرور</label>
                <input type="password" name="password" class="form-control" required>
            </div>
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-warning fw-bold">دخول</button>
                <a href="{{ url_for('login') }}" class="btn btn-outline-secondary">عودة للتطبيق</a>
            </div>
        </form>

        {% else %}

        {% if success_state %}
        <!-- Success State -->
        <div class="text-center py-4">
            <div class="mb-3">
                <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
            </div>
            <h4 class="text-success">تمت العملية بنجاح!</h4>
            <p class="text-muted">{{ message }}</p>

            <div class="d-grid gap-2 mt-4">
                <a href="{{ url_for('login') }}" class="btn btn-primary btn-lg">
                    <i class="fas fa-sign-in-alt"></i> الانتقال إلى تسجيل الدخول
                </a>
                <a href="{{ url_for('setup') }}" class="btn btn-outline-secondary">
                    البقاء في إعدادات المطور
                </a>
            </div>
        </div>

        {% else %}
        <!-- Config & Init Form -->
        <form method="post" action="{{ url_for('setup') }}">
            <div class="row">
                <div class="col-md-8 mb-3">
                    <label class="form-label fw-bold">السيرفر</label>
                    <input type="text" name="server" class="form-control" value="{{ config.server }}" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Port</label>
                    <input type="text" name="port" class="form-control" value="{{ config.port }}" required>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label fw-bold">قاعدة البيانات</label>
                <input type="text" name="database" class="form-control" value="{{ config.database }}" required>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">User</label>
                    <input type="text" name="username" class="form-control" value="{{ config.username }}">
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Password</label>
                    <input type="password" name="password" class="form-control" value="{{ config.password }}">
                </div>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" name="use_trusted" id="useTrusted" {% if
                    config.use_trusted %}checked{% endif %}>
                <label class="form-check-label" for="useTrusted">
                    استخدام مصادقة الويندوز (Windows Authentication) - تجاهل اسم المستخدم وكلمة المرور
                </label>
            </div>

            <div class="row mb-3">
                <div class="col">
                    <button type="submit" class="btn btn-primary w-100"><i class="fas fa-save"></i> حفظ
                        الإعدادات</button>
                </div>
                <div class="col">
                    <button type="submit" formaction="{{ url_for('test_connection') }}"
                        class="btn btn-info w-100 text-white"><i class="fas fa-plug"></i> اختبار الاتصال</button>
                </div>
            </div>

            <hr>

            <div class="card bg-light border-warning mb-3">
                <div class="card-body">
                    <h6 class="card-title text-warning"><i class="fas fa-database"></i> تهيئة قاعدة البيانات</h6>
                    <p class="card-text small text-muted">استخدم هذا الزر فقط عند التشغيل لأول مرة لإنشاء الجداول، أو
                        لتحديث الهيكل عند وجود تغييرات.</p>
                    <button type="submit" formaction="{{ url_for('init_db_route') }}" class="btn btn-warning w-100"
                        onclick="return confirm('هل أنت متأكد؟ سيتم إنشاء الجداول إذا لم تكن موجودة.')">
                        <i class="fas fa-cogs"></i> إنشاء / تحديث الجداول
                    </button>
                </div>
            </div>

        </form>

        <hr class="my-4">
        <div class="text-center">
            <a href="{{ url_for('setup_logout') }}" class="btn btn-sm btn-outline-danger">تسجيل خروج المطور</a>
            <a href="{{ url_for('login') }}" class="btn btn-sm btn-link text-light">عودة للتطبيق</a>
        </div>
        {% endif %}
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>